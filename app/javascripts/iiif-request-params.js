// Generated by CoffeeScript 1.10.0
(function() {
  var IIIFRequestParams;

  IIIFRequestParams = (function() {
    function IIIFRequestParams(url, image_info) {
      var format, height, left, quality, ref, ref1, ref2, region, rotation, size, size_section, top, width;
      this.url = url;
      this.image_info = image_info;
      console.log(this.url);
      this.url_parts = this.url.split('/');
      this.id = this.url_parts[1];
      region = this.url_parts[2];
      if (region === 'full') {
        ref = [0, 0, this.image_info.width, this.image_info.height], left = ref[0], top = ref[1], width = ref[2], height = ref[3];
      } else {
        ref1 = region.split(','), left = ref1[0], top = ref1[1], width = ref1[2], height = ref1[3];
      }
      size_section = this.url_parts[3];
      size = {
        width: parseInt(size_section.split(',')[0])
      };
      rotation = this.url_parts[4];
      ref2 = this.url_parts[5].split('.'), quality = ref2[0], format = ref2[1];
      this.options = {
        identifier: this.id,
        region: {
          top: top,
          left: left,
          height: height,
          width: width
        },
        size: size,
        rotation: rotation,
        quality: quality,
        format: format
      };
      this.options.reduction = this.calculate_reduction();
    }

    IIIFRequestParams.prototype.calculate_reduction = function() {
      var reduction_factor;
      reduction_factor = (this.options.region.width / this.options.size.width) - 1;
      switch (false) {
        case !(reduction_factor >= 12):
          return 6;
        case !(reduction_factor >= 10):
          return 5;
        case !(reduction_factor >= 8):
          return 4;
        case !(reduction_factor >= 6):
          return 3;
        case !(reduction_factor >= 4):
          return 2;
        case !(reduction_factor >= 2):
          return 1;
        default:
          return 0;
      }
    };

    return IIIFRequestParams;

  })();

  module.exports = IIIFRequestParams;

}).call(this);
